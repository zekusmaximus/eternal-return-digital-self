{"version":3,"file":"MarginaliaSidebar-CTlZkFAr.js","sources":["../../src/components/NodeView/MarginaliaSidebar.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { StrangeAttractor } from '../../types';\r\nimport { engageAttractor, selectVisited } from '../../store/slices/readerSlice';\r\nimport { useAppSelector } from '../../store/hooks';\r\nimport './NodeView.css';\r\n\r\ntype SidebarMode = 'breadcrumbs' | /* future */ 'echoes' | 'glossary';\r\n\r\ninterface MarginaliaSidebarProps {\r\n  nodeId: string;\r\n  strangeAttractors: StrangeAttractor[];\r\n  /**\r\n   * Which feature mode to render.  Defaults to \"breadcrumbs\".\r\n   */\r\n  mode?: SidebarMode;\r\n}\r\n\r\n/**\r\n * Sidebar component that displays marginalia related to the current node,\r\n * including strange attractors, connections, and meta-narrative elements\r\n */\r\nconst MarginaliaSidebar: React.FC<MarginaliaSidebarProps> = ({\r\n  nodeId,\r\n  strangeAttractors,\r\n  mode = 'breadcrumbs',\r\n}) => {\r\n  const dispatch = useDispatch();\r\n  const [visible, setVisible] = useState(false);\r\n\r\n  // Reader breadcrumb history (recent-first) – pulled from store\r\n  const visited = useAppSelector(selectVisited) || [];\r\n\r\n  // Legacy notes (kept for future modes)\r\n  const [notes, setNotes] = useState<string[]>([]);\r\n  \r\n  // Toggle sidebar visibility\r\n  const toggleSidebar = () => {\r\n    setVisible(!visible);\r\n  };\r\n  \r\n  // Handle engagement with an attractor\r\n  const handleAttractorClick = (attractor: StrangeAttractor) => {\r\n    dispatch(engageAttractor(attractor));\r\n    \r\n    // Add a note based on the attractor\r\n    // In a real implementation, this would be more sophisticated\r\n    addNote(`Engaged with ${formatAttractorName(attractor)}`);\r\n  };\r\n  \r\n  // Format attractor name for display\r\n  const formatAttractorName = (attractor: StrangeAttractor): string => {\r\n    return attractor\r\n      .replace(/-/g, ' ')\r\n      .split(' ')\r\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1))\r\n      .join(' ');\r\n  };\r\n  \r\n  // Add a note to the marginalia\r\n  const addNote = (note: string) => {\r\n    setNotes(prev => [note, ...prev].slice(0, 10)); // Keep last 10 notes\r\n  };\r\n  \r\n  // Initial sidebar content based on node\r\n  useEffect(() => {\r\n    if (nodeId) {\r\n      // Add initial note based on node ID\r\n      addNote(`Viewing node: ${nodeId}`);\r\n    }\r\n  }, [nodeId]);\r\n  \r\n  // Keyboard handler for toggle and attractor items\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>, action: () => void) => {\r\n    if (e.key === 'Enter' || e.key === ' ') {\r\n      e.preventDefault();\r\n      action();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`marginalia-sidebar ${visible ? 'visible' : ''}`}>\r\n      <div\r\n        className=\"marginalia-toggle\"\r\n        onClick={toggleSidebar}\r\n        onKeyDown={e => handleKeyDown(e, toggleSidebar)}\r\n        tabIndex={0}\r\n        role=\"button\"\r\n        aria-label={visible ? 'Close marginalia sidebar' : 'Open marginalia sidebar'}\r\n      >\r\n        {visible ? '›' : '‹'}\r\n      </div>\r\n\r\n      <div className=\"marginalia-content\">\r\n        {/* Switchable modes */}\r\n        {mode === 'breadcrumbs' && (\r\n          <>\r\n            <h3 className=\"marginalia-header\">Recent Journey</h3>\r\n            <ul className=\"sidebar-breadcrumb-list\">\r\n              {visited.map(v => (\r\n                <li className=\"sidebar-breadcrumb\" key={v.id}>\r\n                  <span className=\"sidebar-breadcrumb__title\">{v.title}</span>\r\n                  <span className=\"sidebar-breadcrumb__synopsis\">{v.synopsis}</span>\r\n                </li>\r\n              ))}\r\n              {visited.length === 0 && (\r\n                <li className=\"sidebar-breadcrumb sidebar-breadcrumb--empty\">\r\n                  No history yet.\r\n                </li>\r\n              )}\r\n            </ul>\r\n          </>\r\n        )}\r\n\r\n        {/* TODO: other modes */}\r\n        {mode !== 'breadcrumbs' && (\r\n          <div className=\"sidebar-placeholder\">\r\n            {/* For now, show attractors + notes as legacy placeholder */}\r\n            <h3 className=\"marginalia-header\">Strange Attractors</h3>\r\n            <div className=\"strange-attractors-list\">\r\n              {strangeAttractors.map(attractor => (\r\n                <div\r\n                  key={attractor}\r\n                  className=\"strange-attractor-item\"\r\n                  onClick={() => handleAttractorClick(attractor)}\r\n                  onKeyDown={e => handleKeyDown(e, () => handleAttractorClick(attractor))}\r\n                  tabIndex={0}\r\n                  role=\"button\"\r\n                  aria-label={`Engage attractor ${formatAttractorName(attractor)}`}\r\n                >\r\n                  {formatAttractorName(attractor)}\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            <h3 className=\"marginalia-header\">Reader Notes</h3>\r\n            <div className=\"reader-notes\">\r\n              {notes.map((note, index) => (\r\n                <div key={index} className=\"reader-note\">\r\n                  {note}\r\n                  <div className=\"reader-note-timestamp\">\r\n                    {new Date().toLocaleTimeString()}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MarginaliaSidebar;"],"names":["MarginaliaSidebar","nodeId","strangeAttractors","mode","dispatch","useDispatch","visible","setVisible","useState","visited","useAppSelector","selectVisited","notes","setNotes","toggleSidebar","handleAttractorClick","attractor","engageAttractor","addNote","formatAttractorName","word","note","prev","useEffect","handleKeyDown","action","jsx","jsxs","Fragment","v","e","index"],"mappings":"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"}