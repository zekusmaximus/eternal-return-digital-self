import{j as n,b as L,O as N}from"./three-vendor-BSwpqFLI.js";import{b as o,u as R,j as b}from"./react-vendor-DaKsb8LL.js";import{w as k,x as A,c as B}from"./constellation-DYOcMIlB.js";import{N as D,C as z}from"./node-view-CX8ZmfD4.js";const O=o.forwardRef(({currentNodeId:i},C)=>{const M=R(),c=b(k),a=b(A),g=o.useRef(null),[w,l]=o.useState(!1),d=o.useMemo(()=>`mini-constellation-canvas-${Date.now()}`,[]);o.useEffect(()=>()=>{var e;try{const t=document.getElementById(d);if(t&&t instanceof HTMLCanvasElement){const r=t.getContext("webgl")||t.getContext("webgl2");r&&((e=r.getExtension("WEBGL_lose_context"))==null||e.loseContext())}}catch(t){console.warn("Error cleaning up WebGL context:",t)}},[d]);const v=o.useMemo(()=>a.map(e=>({source:e.start,target:e.end})),[a]),y=o.useMemo(()=>{const e=new Set;return a.forEach(t=>{t.start===i?e.add(t.end):t.end===i&&e.add(t.start)}),Array.from(e)},[a,i]),E=e=>{M(B(e))},s=o.useMemo(()=>{const e={};return c.forEach((t,r)=>{const j=c.length,u=3,m=2/j,S=Math.PI*(3-Math.sqrt(5)),p=r*m-1+m/2,h=Math.sqrt(1-p*p),x=r*S,I=Math.cos(x)*h*u,P=Math.sin(x)*h*u;e[t.id]=[I,p*u,P]}),e},[c]),f=o.useMemo(()=>({updatePositions:(e,t)=>s,getCurrentPositions:()=>s}),[s]);return n.jsx("div",{ref:C,className:"mini-constellation-container",style:{width:"100%",height:"100%",borderRadius:"8px",cursor:w?"grabbing":"grab",boxShadow:"0 0 10px rgba(0,0,0,0.3)",backgroundColor:"rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)",zIndex:1e3,pointerEvents:"auto",padding:0,margin:0,overflow:"hidden",position:"relative"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 0 15px rgba(255,255,255,0.3)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 0 10px rgba(0,0,0,0.3)",l(!1)},children:n.jsxs(L,{id:d,frameloop:"always",style:{width:"100%",height:"100%",cursor:"grab",touchAction:"none"},camera:{position:[0,0,8],fov:35,near:.1,far:100},gl:{antialias:!0,alpha:!0,powerPreference:"default",preserveDrawingBuffer:!0},dpr:[1,2],performance:{min:.5},children:[n.jsx("ambientLight",{intensity:.8}),n.jsx("pointLight",{position:[10,10,10],intensity:1}),n.jsx("pointLight",{position:[-10,-10,10],intensity:.5}),n.jsx(N,{enableZoom:!1,enablePan:!1,rotateSpeed:1.5,enableDamping:!0,dampingFactor:.1,minPolarAngle:0,maxPolarAngle:Math.PI,onStart:()=>l(!0),onEnd:()=>l(!1),target:[0,0,0]}),n.jsxs("group",{scale:[.6,.6,.6],children:[n.jsx(D,{ref:g,nodes:c,nodePositions:s,connections:a,overrideSelectedNodeId:i,onNodeClick:E,clickableNodeIds:y,isMinimap:!0,isInitialChoicePhase:!1,positionSynchronizer:f}),n.jsx(z,{ref:g,connections:v,nodePositions:s,positionSynchronizer:f})]})]})})});export{O as default};
//# sourceMappingURL=MiniConstellation-oMMB3PYU.js.map
