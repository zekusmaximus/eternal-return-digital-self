const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ThreeJSComponents-DaeX52Mz.js","assets/three-vendor-CMUj8LmA.js","assets/react-vendor-CLXXY-Bz.js","assets/node-view-BVBDDUA3.js","assets/constellation-9EXX-9rV.js","assets/node-view-_8ZIE8wg.css"])))=>i.map(i=>d[i]);
import{j as o,_ as V}from"./three-vendor-CMUj8LmA.js";import{u as _,b as n,c as h}from"./react-vendor-CLXXY-Bz.js";import{y,z as R,d as I}from"./constellation-9EXX-9rV.js";import{v as w,w as b}from"./app-wopjO8iA.js";const S=n.lazy(()=>V(()=>import("./ThreeJSComponents-DaeX52Mz.js"),__vite__mapDeps([0,1,2,3,4,5]))),D=()=>o.jsxs("div",{className:"constellation-loading",children:[o.jsx("div",{className:"loading-spinner"}),o.jsx("p",{children:"Generating constellation view..."})]}),P=({onDismiss:l})=>o.jsxs("div",{className:"webgl-error-container",children:[o.jsx("div",{className:"webgl-error-header",children:"WebGL Error Detected"}),o.jsx("div",{className:"webgl-error-message",children:"A graphics rendering error occurred. This may affect the constellation display. You can continue using the application in text-only mode."}),o.jsx("div",{className:"webgl-error-actions",children:o.jsx("button",{className:"webgl-error-action",onClick:l,children:"Continue in Text Mode"})})]}),A=()=>{const l=_(),[C,a]=n.useState(null),t=h(y),i=h(R),f=n.useRef(null),[s,L]=n.useState(null);n.useEffect(()=>(w.registerViewMount("constellation",!0),()=>{w.registerViewMount("constellation",!1),s&&(console.log(`[ConstellationView] Unmounting, disposing WebGL context: ${s}`),b.disposeContext(s))}),[s]);const v=n.useMemo(()=>i.map(e=>({source:e.start,target:e.end})),[i]),j=n.useMemo(()=>i.map(e=>({source:e.start,target:e.end})),[i]),G=n.useMemo(()=>{console.log("Calculating positions for nodes:",t.length);const e={};return t.length===0?(console.warn("No nodes to position"),e):(t.forEach((r,c)=>{const d=t.length,u=8,x=2/d,M=Math.PI*(3-Math.sqrt(5)),g=c*x-1+x/2,m=Math.sqrt(1-g*g),p=c*M,W=Math.cos(p)*m*u,N=Math.sin(p)*m*u;e[r.id]=[W,g*u,N]}),e)},[t]),E=e=>{const r=b.registerContext(e,"constellation",2,()=>{console.log("[ConstellationView] Suspending WebGL rendering")},()=>{console.log("[ConstellationView] Resuming WebGL rendering")});L(r),console.log(`[ConstellationView] Registered WebGL context: ${r}`)};return n.useEffect(()=>{const e=r=>{const{contextId:c,type:d}=r.detail;(s===c||d==="constellation")&&(console.error("[ConstellationView] Received WebGL context loss event"),a(new Error("WebGL context lost - application event")))};return window.addEventListener("webgl-context-loss",e),()=>{window.removeEventListener("webgl-context-loss",e)}},[s]),o.jsxs("div",{className:"constellation-container",children:[o.jsx(n.Suspense,{fallback:o.jsx(D,{}),children:o.jsx(S,{nodes:t,nodePositions:G,connections:j,mappedConnections:v,instancedMeshRef:f,onWebGLContextCreated:E,onWebGLError:e=>{console.error("[ConstellationView] WebGL error reported:",e),a(e)}})}),C&&o.jsx(P,{onDismiss:()=>{l(I("reading")),a(null)}})]})};export{A as default};
//# sourceMappingURL=ConstellationView-CEQ12AU_.js.map
