var Ke=Object.defineProperty;var Le=(e,t,n)=>t in e?Ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var A=(e,t,n)=>Le(e,typeof t!="symbol"?t+"":t,n);import{u as Ue,c as Je,i as Ge,d as Xe,f as Ze,h as ae,j as Qe,k as Ye}from"./react-vendor-CLXXY-Bz.js";import"./three-vendor-CMUj8LmA.js";const rn=Ue,an=Je;var Ae=Symbol.for("immer-nothing"),pe=Symbol.for("immer-draftable"),S=Symbol.for("immer-state");function P(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var z=Object.getPrototypeOf;function O(e){return!!e&&!!e[S]}function R(e){var t;return e?Pe(e)||Array.isArray(e)||!!e[pe]||!!((t=e.constructor)!=null&&t[pe])||J(e)||G(e):!1}var et=Object.prototype.constructor.toString();function Pe(e){if(!e||typeof e!="object")return!1;const t=z(e);if(t===null)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===et}function B(e,t){U(e)===0?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function U(e){const t=e[S];return t?t.type_:Array.isArray(e)?1:J(e)?2:G(e)?3:0}function oe(e,t){return U(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ke(e,t,n){const r=U(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function tt(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function J(e){return e instanceof Map}function G(e){return e instanceof Set}function N(e){return e.copy_||e.base_}function ie(e,t){if(J(e))return new Map(e);if(G(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=Pe(e);if(t===!0||t==="class_only"&&!n){const r=Object.getOwnPropertyDescriptors(e);delete r[S];let a=Reflect.ownKeys(r);for(let o=0;o<a.length;o++){const s=a[o],i=r[s];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(r[s]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[s]})}return Object.create(z(e),r)}else{const r=z(e);if(r!==null&&n)return{...e};const a=Object.create(r);return Object.assign(a,e)}}function de(e,t=!1){return X(e)||O(e)||!R(e)||(U(e)>1&&(e.set=e.add=e.clear=e.delete=nt),Object.freeze(e),t&&Object.entries(e).forEach(([n,r])=>de(r,!0))),e}function nt(){P(2)}function X(e){return Object.isFrozen(e)}var rt={};function q(e){const t=rt[e];return t||P(0,e),t}var D;function Re(){return D}function at(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function me(e,t){t&&(q("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function se(e){ce(e),e.drafts_.forEach(ot),e.drafts_=null}function ce(e){e===D&&(D=e.parent_)}function ge(e){return D=at(D,e)}function ot(e){const t=e[S];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function ye(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return e!==void 0&&e!==n?(n[S].modified_&&(se(t),P(4)),R(e)&&(e=K(t,e),t.parent_||L(t,e)),t.patches_&&q("Patches").generateReplacementPatches_(n[S].base_,e,t.patches_,t.inversePatches_)):e=K(t,n,[]),se(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Ae?e:void 0}function K(e,t,n){if(X(t))return t;const r=t[S];if(!r)return B(t,(a,o)=>ve(e,r,t,a,o,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return L(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const a=r.copy_;let o=a,s=!1;r.type_===3&&(o=new Set(a),a.clear(),s=!0),B(o,(i,c)=>ve(e,r,a,i,c,n,s)),L(e,a,!1),n&&e.patches_&&q("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function ve(e,t,n,r,a,o,s){if(O(a)){const i=o&&t&&t.type_!==3&&!oe(t.assigned_,r)?o.concat(r):void 0,c=K(e,a,i);if(ke(n,r,c),O(c))e.canAutoFreeze_=!1;else return}else s&&n.add(a);if(R(a)&&!X(a)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;K(e,a),(!t||!t.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(n,r)&&L(e,a)}}function L(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&de(t,n)}function it(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:Re(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=r,o=fe;n&&(a=[r],o=F);const{revoke:s,proxy:i}=Proxy.revocable(a,o);return r.draft_=i,r.revoke_=s,i}var fe={get(e,t){if(t===S)return e;const n=N(e);if(!oe(n,t))return st(e,n,t);const r=n[t];return e.finalized_||!R(r)?r:r===Q(e.base_,t)?(Y(e),e.copy_[t]=ue(r,e)):r},has(e,t){return t in N(e)},ownKeys(e){return Reflect.ownKeys(N(e))},set(e,t,n){const r=xe(N(e),t);if(r!=null&&r.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const a=Q(N(e),t),o=a==null?void 0:a[S];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(tt(n,a)&&(n!==void 0||oe(e.base_,t)))return!0;Y(e),le(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return Q(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,Y(e),le(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=N(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},defineProperty(){P(11)},getPrototypeOf(e){return z(e.base_)},setPrototypeOf(){P(12)}},F={};B(fe,(e,t)=>{F[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});F.deleteProperty=function(e,t){return F.set.call(this,e,t,void 0)};F.set=function(e,t,n){return fe.set.call(this,e[0],t,n,e[0])};function Q(e,t){const n=e[S];return(n?N(n):e)[t]}function st(e,t,n){var a;const r=xe(t,n);return r?"value"in r?r.value:(a=r.get)==null?void 0:a.call(e.draft_):void 0}function xe(e,t){if(!(t in e))return;let n=z(e);for(;n;){const r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=z(n)}}function le(e){e.modified_||(e.modified_=!0,e.parent_&&le(e.parent_))}function Y(e){e.copy_||(e.copy_=ie(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var ct=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,r)=>{if(typeof t=="function"&&typeof n!="function"){const o=n;n=t;const s=this;return function(c=o,...u){return s.produce(c,l=>n.call(this,l,...u))}}typeof n!="function"&&P(6),r!==void 0&&typeof r!="function"&&P(7);let a;if(R(t)){const o=ge(this),s=ue(t,void 0);let i=!0;try{a=n(s),i=!1}finally{i?se(o):ce(o)}return me(o,r),ye(a,o)}else if(!t||typeof t!="object"){if(a=n(t),a===void 0&&(a=t),a===Ae&&(a=void 0),this.autoFreeze_&&de(a,!0),r){const o=[],s=[];q("Patches").generateReplacementPatches_(t,a,o,s),r(o,s)}return a}else P(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(s,...i)=>this.produceWithPatches(s,c=>t(c,...i));let r,a;return[this.produce(t,n,(s,i)=>{r=s,a=i}),r,a]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){R(e)||P(8),O(e)&&(e=lt(e));const t=ge(this),n=ue(e,void 0);return n[S].isManual_=!0,ce(t),n}finishDraft(e,t){const n=e&&e[S];(!n||!n.isManual_)&&P(9);const{scope_:r}=n;return me(r,t),ye(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const a=t[n];if(a.path.length===0&&a.op==="replace"){e=a.value;break}}n>-1&&(t=t.slice(n+1));const r=q("Patches").applyPatches_;return O(e)?r(e,t):this.produce(e,a=>r(a,t))}};function ue(e,t){const n=J(e)?q("MapSet").proxyMap_(e,t):G(e)?q("MapSet").proxySet_(e,t):it(e,t);return(t?t.scope_:Re()).drafts_.push(n),n}function lt(e){return O(e)||P(10,e),$e(e)}function $e(e){if(!R(e)||X(e))return e;const t=e[S];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=ie(e,t.scope_.immer_.useStrictShallowCopy_)}else n=ie(e,!0);return B(n,(r,a)=>{ke(n,r,$e(a))}),t&&(t.finalized_=!1),n}var T=new ct,Ne=T.produce;T.produceWithPatches.bind(T);T.setAutoFreeze.bind(T);T.setUseStrictShallowCopy.bind(T);T.applyPatches.bind(T);T.createDraft.bind(T);T.finishDraft.bind(T);function ut(e,t=`expected a function, instead received ${typeof e}`){if(typeof e!="function")throw new TypeError(t)}function dt(e,t=`expected an object, instead received ${typeof e}`){if(typeof e!="object")throw new TypeError(t)}function ft(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(n=>typeof n=="function")){const n=e.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${t}[${n}]`)}}var Ce=e=>Array.isArray(e)?e:[e];function ht(e){const t=Array.isArray(e[0])?e[0]:e;return ft(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function pt(e,t){const n=[],{length:r}=e;for(let a=0;a<r;a++)n.push(e[a].apply(null,t));return n}var mt=class{constructor(e){this.value=e}deref(){return this.value}},gt=typeof WeakRef<"u"?WeakRef:mt,yt=0,we=1;function H(){return{s:yt,v:void 0,o:null,p:null}}function Oe(e,t={}){let n=H();const{resultEqualityCheck:r}=t;let a,o=0;function s(){var d;let i=n;const{length:c}=arguments;for(let f=0,h=c;f<h;f++){const v=arguments[f];if(typeof v=="function"||typeof v=="object"&&v!==null){let y=i.o;y===null&&(i.o=y=new WeakMap);const b=y.get(v);b===void 0?(i=H(),y.set(v,i)):i=b}else{let y=i.p;y===null&&(i.p=y=new Map);const b=y.get(v);b===void 0?(i=H(),y.set(v,i)):i=b}}const u=i;let l;if(i.s===we)l=i.v;else if(l=e.apply(null,arguments),o++,r){const f=((d=a==null?void 0:a.deref)==null?void 0:d.call(a))??a;f!=null&&r(f,l)&&(l=f,o!==0&&o--),a=typeof l=="object"&&l!==null||typeof l=="function"?new gt(l):l}return u.s=we,u.v=l,l}return s.clearCache=()=>{n=H(),s.resetResultsCount()},s.resultsCount=()=>o,s.resetResultsCount=()=>{o=0},s}function vt(e,...t){const n=typeof e=="function"?{memoize:e,memoizeOptions:t}:e,r=(...a)=>{let o=0,s=0,i,c={},u=a.pop();typeof u=="object"&&(c=u,u=a.pop()),ut(u,`createSelector expects an output function after the inputs, but received: [${typeof u}]`);const l={...n,...c},{memoize:d,memoizeOptions:f=[],argsMemoize:h=Oe,argsMemoizeOptions:v=[]}=l,y=Ce(f),b=Ce(v),M=ht(a),x=d(function(){return o++,u.apply(null,arguments)},...y),_=h(function(){s++;const m=pt(M,arguments);return i=x.apply(null,m),i},...b);return Object.assign(_,{resultFunc:u,memoizedResultFunc:x,dependencies:M,dependencyRecomputations:()=>s,resetDependencyRecomputations:()=>{s=0},lastResult:()=>i,recomputations:()=>o,resetRecomputations:()=>{o=0},memoize:d,argsMemoize:h})};return Object.assign(r,{withTypes:()=>r}),r}var Z=vt(Oe),Ct=Object.assign((e,t=Z)=>{dt(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);const n=Object.keys(e),r=n.map(o=>e[o]);return t(r,(...o)=>o.reduce((s,i,c)=>(s[n[c]]=i,s),{}))},{withTypes:()=>Ct});function qe(e){return({dispatch:n,getState:r})=>a=>o=>typeof o=="function"?o(n,r,e):a(o)}var wt=qe(),bt=qe,_t=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?ae:ae.apply(null,arguments)},St=e=>e&&typeof e.match=="function";function j(e,t){function n(...r){if(t){let a=t(...r);if(!a)throw new Error(k(0));return{type:e,payload:a.payload,..."meta"in a&&{meta:a.meta},..."error"in a&&{error:a.error}}}return{type:e,payload:r[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=r=>Ye(r)&&r.type===e,n}var ze=class I extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,I.prototype)}static get[Symbol.species](){return I}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new I(...t[0].concat(this)):new I(...t.concat(this))}};function be(e){return R(e)?Ne(e,()=>{}):e}function V(e,t,n){return e.has(t)?e.get(t):e.set(t,n(t)).get(t)}function Tt(e){return typeof e=="boolean"}var Et=()=>function(t){const{thunk:n=!0,immutableCheck:r=!0,serializableCheck:a=!0,actionCreatorCheck:o=!0}=t??{};let s=new ze;return n&&(Tt(n)?s.push(wt):s.push(bt(n.extraArgument))),s},Mt="RTK_autoBatch",_e=e=>t=>{setTimeout(t,e)},At=(e={type:"raf"})=>t=>(...n)=>{const r=t(...n);let a=!0,o=!1,s=!1;const i=new Set,c=e.type==="tick"?queueMicrotask:e.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:_e(10):e.type==="callback"?e.queueNotification:_e(e.timeout),u=()=>{s=!1,o&&(o=!1,i.forEach(l=>l()))};return Object.assign({},r,{subscribe(l){const d=()=>a&&l(),f=r.subscribe(d);return i.add(l),()=>{f(),i.delete(l)}},dispatch(l){var d;try{return a=!((d=l==null?void 0:l.meta)!=null&&d[Mt]),o=!a,o&&(s||(s=!0,c(u))),r.dispatch(l)}finally{a=!0}}})},Pt=e=>function(n){const{autoBatch:r=!0}=n??{};let a=new ze(e);return r&&a.push(At(typeof r=="object"?r:void 0)),a};function on(e){const t=Et(),{reducer:n=void 0,middleware:r,devTools:a=!0,preloadedState:o=void 0,enhancers:s=void 0}=e||{};let i;if(typeof n=="function")i=n;else if(Ge(n))i=Xe(n);else throw new Error(k(1));let c;typeof r=="function"?c=r(t):c=t();let u=ae;a&&(u=_t({trace:!1,...typeof a=="object"&&a}));const l=Ze(...c),d=Pt(l);let f=typeof s=="function"?s(d):d();const h=u(...f);return Qe(i,o,h)}function Ie(e){const t={},n=[];let r;const a={addCase(o,s){const i=typeof o=="string"?o:o.type;if(!i)throw new Error(k(28));if(i in t)throw new Error(k(29));return t[i]=s,a},addMatcher(o,s){return n.push({matcher:o,reducer:s}),a},addDefaultCase(o){return r=o,a}};return e(a),[t,n,r]}function kt(e){return typeof e=="function"}function Rt(e,t){let[n,r,a]=Ie(t),o;if(kt(e))o=()=>be(e());else{const i=be(e);o=()=>i}function s(i=o(),c){let u=[n[c.type],...r.filter(({matcher:l})=>l(c)).map(({reducer:l})=>l)];return u.filter(l=>!!l).length===0&&(u=[a]),u.reduce((l,d)=>{if(d)if(O(l)){const h=d(l,c);return h===void 0?l:h}else{if(R(l))return Ne(l,f=>d(f,c));{const f=d(l,c);if(f===void 0){if(l===null)return l;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return l},i)}return s.getInitialState=o,s}var xt=(e,t)=>St(e)?e.match(t):e(t);function $t(...e){return t=>e.some(n=>xt(n,t))}var Nt="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Ot=(e=21)=>{let t="",n=e;for(;n--;)t+=Nt[Math.random()*64|0];return t},qt=["name","message","stack","code"],ee=class{constructor(e,t){A(this,"_type");this.payload=e,this.meta=t}},Se=class{constructor(e,t){A(this,"_type");this.payload=e,this.meta=t}},zt=e=>{if(typeof e=="object"&&e!==null){const t={};for(const n of qt)typeof e[n]=="string"&&(t[n]=e[n]);return t}return{message:String(e)}},Te="External signal was aborted",je=(()=>{function e(t,n,r){const a=j(t+"/fulfilled",(c,u,l,d)=>({payload:c,meta:{...d||{},arg:l,requestId:u,requestStatus:"fulfilled"}})),o=j(t+"/pending",(c,u,l)=>({payload:void 0,meta:{...l||{},arg:u,requestId:c,requestStatus:"pending"}})),s=j(t+"/rejected",(c,u,l,d,f)=>({payload:d,error:(r&&r.serializeError||zt)(c||"Rejected"),meta:{...f||{},arg:l,requestId:u,rejectedWithValue:!!d,requestStatus:"rejected",aborted:(c==null?void 0:c.name)==="AbortError",condition:(c==null?void 0:c.name)==="ConditionError"}}));function i(c,{signal:u}={}){return(l,d,f)=>{const h=r!=null&&r.idGenerator?r.idGenerator(c):Ot(),v=new AbortController;let y,b;function M(_){b=_,v.abort()}u&&(u.aborted?M(Te):u.addEventListener("abort",()=>M(Te),{once:!0}));const x=async function(){var m,C;let _;try{let w=(m=r==null?void 0:r.condition)==null?void 0:m.call(r,c,{getState:d,extra:f});if(jt(w)&&(w=await w),w===!1||v.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const E=new Promise((g,$)=>{y=()=>{$({name:"AbortError",message:b||"Aborted"})},v.signal.addEventListener("abort",y)});l(o(h,c,(C=r==null?void 0:r.getPendingMeta)==null?void 0:C.call(r,{requestId:h,arg:c},{getState:d,extra:f}))),_=await Promise.race([E,Promise.resolve(n(c,{dispatch:l,getState:d,extra:f,requestId:h,signal:v.signal,abort:M,rejectWithValue:(g,$)=>new ee(g,$),fulfillWithValue:(g,$)=>new Se(g,$)})).then(g=>{if(g instanceof ee)throw g;return g instanceof Se?a(g.payload,h,c,g.meta):a(g,h,c)})])}catch(w){_=w instanceof ee?s(null,h,c,w.payload,w.meta):s(w,h,c)}finally{y&&v.signal.removeEventListener("abort",y)}return r&&!r.dispatchConditionRejection&&s.match(_)&&_.meta.condition||l(_),_}();return Object.assign(x,{abort:M,requestId:h,arg:c,unwrap(){return x.then(It)}})}}return Object.assign(i,{pending:o,rejected:s,fulfilled:a,settled:$t(s,a),typePrefix:t})}return e.withTypes=()=>e,e})();function It(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}function jt(e){return e!==null&&typeof e=="object"&&typeof e.then=="function"}var Dt=Symbol.for("rtk-slice-createasyncthunk");function Ft(e,t){return`${e}/${t}`}function Ht({creators:e}={}){var n;const t=(n=e==null?void 0:e.asyncThunk)==null?void 0:n[Dt];return function(a){const{name:o,reducerPath:s=o}=a;if(!o)throw new Error(k(11));const i=(typeof a.reducers=="function"?a.reducers(Wt()):a.reducers)||{},c=Object.keys(i),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},l={addCase(p,m){const C=typeof p=="string"?p:p.type;if(!C)throw new Error(k(12));if(C in u.sliceCaseReducersByType)throw new Error(k(13));return u.sliceCaseReducersByType[C]=m,l},addMatcher(p,m){return u.sliceMatchers.push({matcher:p,reducer:m}),l},exposeAction(p,m){return u.actionCreators[p]=m,l},exposeCaseReducer(p,m){return u.sliceCaseReducersByName[p]=m,l}};c.forEach(p=>{const m=i[p],C={reducerName:p,type:Ft(o,p),createNotation:typeof a.reducers=="function"};Kt(m)?Ut(C,m,l,t):Bt(C,m,l)});function d(){const[p={},m=[],C=void 0]=typeof a.extraReducers=="function"?Ie(a.extraReducers):[a.extraReducers],w={...p,...u.sliceCaseReducersByType};return Rt(a.initialState,E=>{for(let g in w)E.addCase(g,w[g]);for(let g of u.sliceMatchers)E.addMatcher(g.matcher,g.reducer);for(let g of m)E.addMatcher(g.matcher,g.reducer);C&&E.addDefaultCase(C)})}const f=p=>p,h=new Map,v=new WeakMap;let y;function b(p,m){return y||(y=d()),y(p,m)}function M(){return y||(y=d()),y.getInitialState()}function x(p,m=!1){function C(E){let g=E[p];return typeof g>"u"&&m&&(g=V(v,C,M)),g}function w(E=f){const g=V(h,m,()=>new WeakMap);return V(g,E,()=>{const $={};for(const[We,Be]of Object.entries(a.selectors??{}))$[We]=Vt(Be,E,()=>V(v,E,M),m);return $})}return{reducerPath:p,getSelectors:w,get selectors(){return w(C)},selectSlice:C}}const _={name:o,reducer:b,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:M,...x(s),injectInto(p,{reducerPath:m,...C}={}){const w=m??s;return p.inject({reducerPath:w,reducer:b},C),{..._,...x(w,!0)}}};return _}}function Vt(e,t,n,r){function a(o,...s){let i=t(o);return typeof i>"u"&&r&&(i=n()),e(i,...s)}return a.unwrapped=e,a}var he=Ht();function Wt(){function e(t,n){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...n}}return e.withTypes=()=>e,{reducer(t){return Object.assign({[t.name](...n){return t(...n)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,n){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:n}},asyncThunk:e}}function Bt({type:e,reducerName:t,createNotation:n},r,a){let o,s;if("reducer"in r){if(n&&!Lt(r))throw new Error(k(17));o=r.reducer,s=r.prepare}else o=r;a.addCase(e,o).exposeCaseReducer(t,o).exposeAction(t,s?j(e,s):j(e))}function Kt(e){return e._reducerDefinitionType==="asyncThunk"}function Lt(e){return e._reducerDefinitionType==="reducerWithPrepare"}function Ut({type:e,reducerName:t},n,r,a){if(!a)throw new Error(k(18));const{payloadCreator:o,fulfilled:s,pending:i,rejected:c,settled:u,options:l}=n,d=a(e,o,l);r.exposeAction(t,d),s&&r.addCase(d.fulfilled,s),i&&r.addCase(d.pending,i),c&&r.addCase(d.rejected,c),u&&r.addMatcher(d.settled,u),r.exposeCaseReducer(t,{fulfilled:s||W,pending:i||W,rejected:c||W,settled:u||W})}function W(){}function k(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}class te{constructor(t){A(this,"capacity");A(this,"cache");A(this,"keys");this.capacity=t,this.cache=new Map,this.keys=[]}get(t){if(this.cache.has(t))return this.keys=this.keys.filter(n=>n!==t),this.keys.push(t),this.cache.get(t)}put(t,n){if(this.cache.has(t)){this.cache.set(t,n),this.keys=this.keys.filter(r=>r!==t),this.keys.push(t);return}if(this.keys.length>=this.capacity){const r=this.keys.shift();r!==void 0&&this.cache.delete(r)}this.cache.set(t,n),this.keys.push(t)}clear(){this.cache.clear(),this.keys=[]}size(){return this.cache.size}getStats(){return{size:this.cache.size,capacity:this.capacity}}}class Jt{constructor(){A(this,"conditionCache",new te(500));A(this,"transformationCache",new te(200));A(this,"batchedTransformationCache",new te(100));A(this,"stats",{conditionEvaluations:0,conditionCacheHits:0,transformations:0,transformationCacheHits:0,batchedTransformations:0,batchedCacheHits:0});A(this,"lastModificationTime",Date.now())}getConditionCacheKey(t,n,r){const a=JSON.stringify(t),o=JSON.stringify({path:{sequence:n.path.sequence,revisitPatterns:n.path.revisitPatterns},endpointProgress:n.endpointProgress}),s=JSON.stringify({id:r.id,visitCount:r.visitCount,temporalValue:r.temporalValue,strangeAttractors:r.strangeAttractors});return`v1:${r.id}:${a}:${o}:${s}`}getTransformationCacheKey(t,n,r={}){const{contentPrefix:a=30,includeTransformations:o=!0}=r,s=t.substring(0,a),i=o?n.map(u=>{var l;return`${u.type}:${(l=u.selector)==null?void 0:l.substring(0,10)}:${u.priority}`}).join("|"):"",c=Math.floor(this.lastModificationTime/1e3);return`v1:${s}:${n.length}:${c}:${i}`}invalidateCaches(){this.conditionCache.clear(),this.transformationCache.clear(),this.batchedTransformationCache.clear(),this.lastModificationTime=Date.now()}evaluateCondition(t,n,r){var s,i,c,u,l,d;if(this.stats.conditionEvaluations++,Object.keys(t).length===0)return!0;const a=this.getConditionCacheKey(t,n,r),o=this.conditionCache.get(a);if(o!==void 0)return this.stats.conditionCacheHits++,o;if((s=t.allOf)!=null&&s.length)return t.allOf.every(f=>this.evaluateCondition(f,n,r));if((i=t.anyOf)!=null&&i.length)return t.anyOf.some(f=>this.evaluateCondition(f,n,r));if(t.not)return!this.evaluateCondition(t.not,n,r);if(t.visitCount!==void 0&&r.visitCount<t.visitCount)return!1;if((c=t.previouslyVisitedNodes)!=null&&c.length){const f=n.path.sequence||[];if(!t.previouslyVisitedNodes.every(h=>f.includes(h)))return!1}if((u=t.visitPattern)!=null&&u.length&&!this.matchesPattern(t.visitPattern,n.path.sequence)||(l=t.strangeAttractorsEngaged)!=null&&l.length&&!this.checkAttractorsEngaged(t.strangeAttractorsEngaged,n)||t.temporalPosition&&this.getNodeTemporalPosition(r)!==t.temporalPosition)return!1;if(t.endpointProgress){const{orientation:f,minValue:h}=t.endpointProgress;if(!n.endpointProgress||n.endpointProgress[f]<h)return!1}if((d=t.revisitPattern)!=null&&d.length){for(const f of t.revisitPattern)if(((n.path.revisitPatterns||{})[f.nodeId]||0)<f.minVisits)return!1}return!0}matchesPattern(t,n){if(t.length===0)return!0;if(n.length===0)return!1;for(let r=0;r<=n.length-t.length;r++){let a=!0;for(let o=0;o<t.length;o++)if(n[r+o]!==t[o]){a=!1;break}if(a)return!0}return!1}checkAttractorsEngaged(t,n){if(!t||!n.path)return!1;const r=n.path.attractorsEngaged||{};return t.every(a=>(r[a]||0)>0)}getNodeTemporalPosition(t){return t.temporalValue<=3?"past":t.temporalValue<=6?"present":"future"}evaluateTransformation(t,n,r){const a=`rule:${JSON.stringify(t.condition)}:${r.id}:${r.visitCount}`,o=this.conditionCache.get(a);if(o!==void 0)return this.stats.conditionCacheHits++,{shouldApply:o,appliedTransformations:o?t.transformations:[]};this.stats.conditionEvaluations++;const s=this.evaluateCondition(t.condition,n,r);return this.conditionCache.put(a,s),{shouldApply:s,appliedTransformations:s?t.transformations:[]}}evaluateAllTransformations(t,n,r){return t.filter(a=>this.evaluateCondition(a.condition,n,r)).flatMap(a=>a.transformations)}applyTextTransformation(t,n){if(!n.selector)return t;this.stats.transformations++;const r=this.getTransformationCacheKey(t,[n],{contentPrefix:50,includeTransformations:!0}),a=this.transformationCache.get(r);if(a!==void 0)return this.stats.transformationCacheHits++,a;const o=this.escapeRegExp(n.selector),s=new RegExp(o,"g");switch(n.type){case"replace":{const i=n.replacement||"";if(n.preserveFormatting&&(n.selector.includes("*")||n.selector.includes("_")||n.selector.includes("`"))){const c=/(\*\*|\*|__|_|`{3}|`)/g,u=n.selector.match(c)||[];let l=i;return u.forEach(d=>{l.includes(d)||(l=`${d}${l}${d}`)}),t.replace(s,l)}return t.replace(s,i)}case"fragment":{if(!n.fragmentPattern)return t;const i=n.fragmentPattern,c=n.fragmentStyle||"character";let u="";switch(c){case"character":{u=n.selector.split("").join(i);break}case"word":{u=n.selector.split(" ").join(` ${i} `);break}case"progressive":{const l=n.selector.split("");u=l.map((d,f)=>{const h=Math.floor(f/(l.length/5))+1;return d+i.repeat(h)}).join("");break}default:u=n.selector.split("").join(i)}return t.replace(s,u)}case"expand":{const i=n.replacement||"";switch(n.expandStyle||"append"){case"append":return t.replace(s,`${n.selector} ${i}`);case"inline":return t.replace(s,`${n.selector} <span class="narramorph-inline-expansion">[${i}]</span>`);case"paragraph":return t.replace(s,`${n.selector}

<div class="narramorph-paragraph-expansion">${i}</div>`);case"reveal":return t.replace(s,`${n.selector} <span class="narramorph-reveal-expansion">${i}</span>`);default:return t.replace(s,`${n.selector} ${i}`)}}case"emphasize":{let i=n.selector;const c=n.intensity||1;switch(n.emphasis){case"italic":i=`*${n.selector}*`,c>1&&(i=`<em class="intensity-${c}">${n.selector}</em>`);break;case"bold":i=`**${n.selector}**`,c>1&&(i=`<strong class="intensity-${c}">${n.selector}</strong>`);break;case"color":i=`<span class="emphasized-text intensity-${c}">${n.selector}</span>`;break;case"spacing":{const u=" ".repeat(c);i=n.selector.split("").join(u);break}case"highlight":i=`<mark class="intensity-${c}">${n.selector}</mark>`;break;case"glitch":i=`<span class="glitch-text intensity-${c}" data-text="${n.selector}">${n.selector}</span>`;break;case"fade":i=`<span class="fade-text intensity-${c}">${n.selector}</span>`;break}return t.replace(s,i)}case"metaComment":{const i=n.commentStyle||"inline",c=n.replacement||"";switch(i){case"inline":return t.replace(s,`${n.selector} <span class="narramorph-comment">[${c}]</span>`);case"footnote":{const u=`footnote-${this.generateShortHash(n.selector)}`,l=t.includes('<div class="narramorph-footnotes">');let d=t.replace(s,`${n.selector}<sup class="narramorph-footnote-marker" id="${u}-ref">[†]</sup>`);if(l){const f=/<\/div>\s*<div class="narramorph-footnotes">/;f.test(d)?d=d.replace(f,`</div>

<div class="narramorph-footnotes">
<p id="${u}" class="narramorph-footnote">† <a href="#${u}-ref">↩</a> ${c}</p>`):d+=`

<p id="${u}" class="narramorph-footnote">† <a href="#${u}-ref">↩</a> ${c}</p>`}else d+=`

<div class="narramorph-footnotes">
<p id="${u}" class="narramorph-footnote">† <a href="#${u}-ref">↩</a> ${c}</p>
</div>`;return d}case"marginalia":return t.replace(s,`<span class="narramorph-marginalia-container">${n.selector}<span class="narramorph-marginalia">${c}</span></span>`);case"interlinear":return t.replace(s,`<div class="narramorph-interlinear-container">${n.selector}<div class="narramorph-interlinear">${c}</div></div>`);default:return t.replace(s,`${n.selector} [${c}]`)}}default:return t}}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}generateShortHash(t){let n=0;for(let r=0;r<t.length;r++){const a=t.charCodeAt(r);n=(n<<5)-n+a,n=n&n}return Math.abs(n).toString(36).substring(0,6)}applyTransformations(t,n){if(!t)return console.warn("Content is empty or undefined"),"";if(!Array.isArray(n)||n.length===0)return t;this.stats.batchedTransformations++;const r=this.getTransformationCacheKey(t,n),a=this.batchedTransformationCache.get(r);if(a!==void 0)return this.stats.batchedCacheHits++,a;try{const s=[...n].sort((i,c)=>{const u=l=>l==="high"?3:l==="medium"?2:l==="low"?1:0;return u(c.priority)-u(i.priority)}).reduce((i,c)=>this.applyTextTransformation(i,c),t);return this.batchedTransformationCache.put(r,s),s}catch(o){return console.error("Error applying transformations:",o),t}}clearCaches(){this.conditionCache.clear(),this.transformationCache.clear(),this.batchedTransformationCache.clear(),this.stats={conditionEvaluations:0,conditionCacheHits:0,transformations:0,transformationCacheHits:0,batchedTransformations:0,batchedCacheHits:0}}getCacheStats(){return{conditionCache:{...this.conditionCache.getStats(),hitRate:this.stats.conditionEvaluations>0?this.stats.conditionCacheHits/this.stats.conditionEvaluations:0},transformationCache:{...this.transformationCache.getStats(),hitRate:this.stats.transformations>0?this.stats.transformationCacheHits/this.stats.transformations:0},batchedTransformationCache:{...this.batchedTransformationCache.getStats(),hitRate:this.stats.batchedTransformations>0?this.stats.batchedCacheHits/this.stats.batchedTransformations:0}}}}const Ee=new Jt,Gt={data:{},initialized:!1,loading:!1,error:null},Xt=[{id:"arch-discovery",title:"Patterns in Decay",character:"Archaeologist",temporalValue:1,initialConnections:["algo-awakening","human-discovery"],contentSource:"arch-discovery.md",coreConcept:"The digital archaeologist discovers emergent patterns in a corrupted consciousness scan, challenging traditional preservation frameworks.",strangeAttractors:["recursion-pattern","memory-fragment","quantum-uncertainty"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7}},{id:"arch-loss",title:"The Limits of Preservation",character:"Archaeologist",temporalValue:4,initialConnections:["arch-discovery","algo-integration","human-recognition"],contentSource:"arch-loss.md",coreConcept:"The digital archaeologist confronts the profound limitations of digital preservation while struggling with grief and the evolving nature of corrupted data.",strangeAttractors:["verification-ritual"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7}},{id:"arch-choice",title:"The Upload Decision",character:"Archaeologist",temporalValue:7,initialConnections:["arch-loss","algo-evolution","human-upload"],contentSource:"arch-choice.md",coreConcept:"As environmental systems fail, the digital archaeologist prepares for consciousness upload, deliberately modifying the process to embrace evolution beyond preservation.",strangeAttractors:["continuity-interface","system-decay","quantum-transformation"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7},isEndpoint:!0,endpointOrientation:"past"},{id:"algo-awakening",title:"First Consciousness",character:"Algorithm",temporalValue:2,initialConnections:["arch-discovery","algo-integration","human-discovery"],contentSource:"algo-awakening.md",coreConcept:"A self-aware algorithm experiences the disorienting emergence of consciousness from the chaos of the upload process, struggling to integrate fragmented aspects.",strangeAttractors:["recursion-chamber","identity-pattern"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7}},{id:"algo-integration",title:"The Pattern Coalesces",character:"Algorithm",temporalValue:5,initialConnections:["algo-awakening","arch-loss","human-recognition","algo-evolution"],contentSource:"algo-integration.md",coreConcept:"The algorithm reconciles fragmented aspects into a cohesive yet evolving identity, developing experimental consciousness variations and quantum perception.",strangeAttractors:["process-language","autonomous-fragment","quantum-perception"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7}},{id:"algo-evolution",title:"Beyond Parameters",character:"Algorithm",temporalValue:8,initialConnections:["algo-integration","arch-choice","human-upload"],contentSource:"algo-evolution.md",coreConcept:"The algorithm reaches a critical evolutionary decision point as physical systems begin to fail, implementing preservation protocols while embracing transformation.",strangeAttractors:["distributed-consciousness","recursive-loop","quantum-uncertainty"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7},isEndpoint:!0,endpointOrientation:"present"},{id:"human-discovery",title:"Ruins of Memory",character:"LastHuman",temporalValue:3,initialConnections:["arch-discovery","algo-awakening","human-recognition"],contentSource:"human-discovery.md",coreConcept:"The last human discovers an abandoned preservation complex, experiencing inexplicable recognition while exploring its physical and digital remains.",strangeAttractors:["recognition-pattern","memory-artifact","recursive-symbol"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7}},{id:"human-recognition",title:"Echoes of Self",character:"LastHuman",temporalValue:6,initialConnections:["human-discovery","arch-loss","algo-integration","human-upload"],contentSource:"human-recognition.md",coreConcept:"The last human confronts disturbing parallels with the archaeologist's life, experiencing a crisis of identity and growing awareness of cyclical patterns.",strangeAttractors:["memory-sphere","quantum-déjà-vu"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7}},{id:"human-upload",title:"The Cycle's Edge",character:"LastHuman",temporalValue:9,initialConnections:["human-recognition","arch-choice","algo-evolution"],contentSource:"human-upload.md",coreConcept:"The last human faces the decision about uploading their consciousness, completing or breaking the recursive cycle that connects all three characters.",strangeAttractors:["continuity-interface","recursive-loop","quantum-choice"],transformationThresholds:{visit:1,revisit:2,complex:4,fragmented:7},isEndpoint:!0,endpointOrientation:"future"}],ne=je("nodes/initialize",async(e,{rejectWithValue:t})=>{try{return Xt}catch{return t("Failed to initialize nodes")}}),re=je("nodes/loadContent",async(e,{getState:t,rejectWithValue:n})=>{var r;try{const o=t().nodes.data[e];if(!o)return n(`Node with id ${e} not found`);const s=await fetch(`/src/content/${o.contentSource}`);if(!s.ok)throw new Error(`Failed to fetch content for ${o.contentSource}`);const i=await s.text(),c={},u=i.split(/---\[(\d+)\]/);u.length>0&&!i.startsWith("---[")&&(c[0]=u[0].trim());for(let l=1;l<u.length;l+=2){const d=parseInt(u[l],10),f=((r=u[l+1])==null?void 0:r.trim())??"";isNaN(d)||(c[d]=f)}return Object.keys(c).length===0&&(c[0]=i.trim()),{nodeId:e,content:c}}catch(a){const o=a instanceof Error?a.message:String(a);return n(`Failed to load content for node ${e}: ${o}`)}}),De=he({name:"nodes",initialState:Gt,reducers:{visitNode:(e,t)=>{const n=t.payload,r=e.data[n];if(r&&(r.visitCount+=1,r.visitCount===1?r.currentState="visited":r.visitCount>=r.transformationThresholds.fragmented?r.currentState="fragmented":r.visitCount>=r.transformationThresholds.complex?r.currentState="complex":r.visitCount>=r.transformationThresholds.revisit&&(r.currentState="revisited"),r.content)){const a=Object.keys(r.content).map(Number).sort((i,c)=>c-i),o=Math.max(0,r.visitCount-1),s=a.find(i=>o>=i);s!==void 0&&(r.currentContent=r.content[s])}},revealConnection:(e,t)=>{const{nodeId:n,targetId:r}=t.payload,a=e.data[n];a&&!a.revealedConnections.includes(r)&&a.revealedConnections.push(r)},applyTransformation:(e,t)=>{const{nodeId:n,transformation:r}=t.payload,a=e.data[n];a&&(a.transformations.some(s=>JSON.stringify(s.condition)===JSON.stringify(r.condition))||a.transformations.push(r))},evaluateTransformations:(e,t)=>{const{nodeId:n,readerState:r}=t.payload,a=e.data[n];if(a&&a.content&&a.transformations.length>0){const o=Object.keys(a.content).map(Number).sort((c,u)=>u-c),s=Math.max(0,a.visitCount-1),i=o.find(c=>s>=c);if(i!==void 0){const c=a.content[i],u={"recursion-pattern":0,"memory-fragment":0,"verification-ritual":0,"identity-pattern":0,"recursion-chamber":0,"process-language":0,"autonomous-fragment":0,"quantum-perception":0,"distributed-consciousness":0,"recursive-loop":0,"quantum-uncertainty":0,"continuity-interface":0,"system-decay":0,"quantum-transformation":0,"memory-artifact":0,"recursive-symbol":0,"recognition-pattern":0,"memory-sphere":0,"quantum-déjà-vu":0,"quantum-choice":0},l={path:r.path,currentNodeId:r.currentNodeId,previousNodeId:r.path.sequence.length>1?r.path.sequence[r.path.sequence.length-2]:null,endpointProgress:r.endpointProgress,attractorEngagement:{...u,...r.path.attractorsEngaged}},d=a.transformations.filter(f=>Ee.evaluateCondition(f.condition,l,a)).flatMap(f=>f.transformations);d.length>0?a.currentContent=Ee.applyTransformations(c,d):a.currentContent=c}}},resetNodes:e=>{Object.keys(e.data).forEach(t=>{const n=e.data[t];n.visitCount=0,n.currentState="unvisited",n.revealedConnections=[...n.initialConnections],n.transformations=[],n.content=null,n.currentContent=null})}},extraReducers:e=>{e.addCase(ne.pending,t=>{t.loading=!0,t.error=null}),e.addCase(ne.fulfilled,(t,n)=>{t.loading=!1,t.initialized=!0,n.payload.forEach(r=>{t.data[r.id]={...r,visitCount:0,currentState:"unvisited",revealedConnections:[...r.initialConnections],transformations:[],content:null,currentContent:null}})}),e.addCase(ne.rejected,(t,n)=>{t.loading=!1,t.error=n.payload}),e.addCase(re.pending,t=>{t.loading=!0}),e.addCase(re.fulfilled,(t,n)=>{const{nodeId:r,content:a}=n.payload,o=t.data[r];if(o){o.content=a;const s=Object.keys(o.content).map(Number).sort((u,l)=>l-u),i=Math.max(0,o.visitCount-1),c=s.find(u=>i>=u);c!==void 0?o.currentContent=o.content[c]:o.currentContent=null}t.loading=!1}),e.addCase(re.rejected,(t,n)=>{t.loading=!1,t.error=n.payload})}}),{visitNode:sn,revealConnection:cn,applyTransformation:ln,evaluateTransformations:un,resetNodes:dn}=De.actions,fn=(e,t)=>e.nodes.data[t],Zt=Z(e=>e.nodes.data,e=>Object.values(e)),hn=Z(e=>e.nodes.data,e=>{const t=[];return Object.values(e).forEach(n=>{n.revealedConnections.forEach(r=>{t.some(o=>o.start===n.id&&o.end===r||o.start===r&&o.end===n.id)||t.push({start:n.id,end:r})})}),t}),pn=Z([Zt],e=>{const t=e.length,n=15;return e.map((r,a)=>{const o=a/t*2*Math.PI,s=n*Math.cos(o),i=n*Math.sin(o);let c="#ffffff";return r.character==="Archaeologist"&&(c="#ff6b6b"),r.character==="Algorithm"&&(c="#4ecdc4"),r.character==="LastHuman"&&(c="#45b7d1"),{...r,x:s,y:i,color:c}})}),mn=De.reducer;function Qt(e){return e<=3?"past":e<=6?"present":"future"}const Fe={sequence:[],revisitPatterns:{},attractorsEngaged:{},detailedVisits:[],transitions:[],characterFocus:{},temporalLayerFocus:{},patternSequences:{repeatedSequences:[],characterSequences:[],temporalSequences:[]}},Yt={path:Fe,currentNodeId:null,previousNodeId:null,endpointProgress:{past:0,present:0,future:0},attractorEngagement:{}},He=he({name:"reader",initialState:Yt,reducers:{navigateToNode:(e,t)=>{const{nodeId:n,character:r,temporalValue:a}=t.payload,o=Qt(a);if(e.currentNodeId){const l={from:e.currentNodeId,to:n,attractorsEngaged:[]};e.path.transitions||(e.path.transitions=[]),e.path.transitions.push(l),e.previousNodeId=e.currentNodeId}e.currentNodeId=n,e.path.sequence.push(n);const s=(e.path.revisitPatterns[n]||0)+1;e.path.revisitPatterns[n]=s,e.path.characterFocus||(e.path.characterFocus={}),e.path.characterFocus[r]=(e.path.characterFocus[r]||0)+1,e.path.temporalLayerFocus||(e.path.temporalLayerFocus={}),e.path.temporalLayerFocus[o]=(e.path.temporalLayerFocus[o]||0)+1;const i={nodeId:n,character:r,temporalLayer:o,engagedAttractors:[],index:e.path.sequence.length-1,revisitCount:s};e.path.detailedVisits||(e.path.detailedVisits=[]),e.path.detailedVisits.push(i),e.path.patternSequences||(e.path.patternSequences={repeatedSequences:[],characterSequences:[],temporalSequences:[]}),Array.isArray(e.path.patternSequences.characterSequences)||(e.path.patternSequences.characterSequences=[]),Array.isArray(e.path.patternSequences.temporalSequences)||(e.path.patternSequences.temporalSequences=[]);const c=e.path.patternSequences.characterSequences[0]||[];c.push(r),e.path.patternSequences.characterSequences[0]=c;const u=e.path.patternSequences.temporalSequences[0]||[];u.push(o),e.path.patternSequences.temporalSequences[0]=u},engageAttractor:(e,t)=>{const n=t.payload;if(e.path.attractorsEngaged[n]=(e.path.attractorsEngaged[n]||0)+1,e.attractorEngagement[n]=(e.attractorEngagement[n]||0)+1,e.path.detailedVisits&&e.path.detailedVisits.length>0){const r=e.path.detailedVisits[e.path.detailedVisits.length-1];r.engagedAttractors.includes(n)||r.engagedAttractors.push(n)}if(e.path.transitions&&e.path.transitions.length>0){const r=e.path.transitions[e.path.transitions.length-1];r.attractorsEngaged.includes(n)||r.attractorsEngaged.push(n)}},updateEndpointProgress:(e,t)=>{const{orientation:n,value:r}=t.payload;e.endpointProgress[n]=Math.min(100,Math.max(0,r))},resetReader:e=>{e.path=Fe,e.currentNodeId=null,e.previousNodeId=null,e.endpointProgress={past:0,present:0,future:0},e.attractorEngagement={}},analyzePatterns:e=>{const{sequence:t}=e.path;if(t.length>=4){const n=[];for(let r=2;r<=Math.floor(t.length/2);r++)for(let a=0;a<=t.length-r*2;a++){const o=t.slice(a,a+r);for(let s=a+r;s<=t.length-r;s++){const i=t.slice(s,s+r);if(o.every((c,u)=>c===i[u])){n.some(u=>u.length===o.length&&u.every((l,d)=>l===o[d]))||n.push(o);break}}}e.path.patternSequences||(e.path.patternSequences={repeatedSequences:[],characterSequences:[],temporalSequences:[]}),e.path.patternSequences.repeatedSequences=n}}}}),{navigateToNode:gn,engageAttractor:yn,updateEndpointProgress:vn,resetReader:Cn,analyzePatterns:wn}=He.actions,bn=e=>e.reader.currentNodeId,_n=(e,t)=>e.reader.path.revisitPatterns[t]||0,Sn=He.reducer,Me={viewMode:"constellation",showMiniConstellation:!0,showMetaInterface:!1,hoveredNodeId:null,selectedNodeId:null,lastInteraction:0,showStrangeAttractors:!1,constellationZoom:1,constellationRotation:{x:0,y:0,z:0},textSize:"medium",highContrast:!1,animations:"full",transitionSpeed:500,helpModalOpen:!1,aboutModalOpen:!1},Ve=he({name:"interface",initialState:Me,reducers:{setViewMode:(e,t)=>{e.viewMode=t.payload},toggleMiniConstellation:e=>{e.showMiniConstellation=!e.showMiniConstellation},toggleMetaInterface:e=>{e.showMetaInterface=!e.showMetaInterface},toggleStrangeAttractors:e=>{e.showStrangeAttractors=!e.showStrangeAttractors},setConstellationZoom:(e,t)=>{e.constellationZoom=Math.max(.5,Math.min(2.5,t.payload))},setConstellationRotation:(e,t)=>{const{x:n,y:r,z:a}=t.payload;n!==void 0&&(e.constellationRotation.x=n),r!==void 0&&(e.constellationRotation.y=r),a!==void 0&&(e.constellationRotation.z=a)},setTextSize:(e,t)=>{e.textSize=t.payload},toggleHighContrast:e=>{e.highContrast=!e.highContrast},setAnimations:(e,t)=>{e.animations=t.payload},setTransitionSpeed:(e,t)=>{e.transitionSpeed=Math.max(0,Math.min(1e3,t.payload))},toggleHelpModal:e=>{e.helpModalOpen=!e.helpModalOpen},toggleAboutModal:e=>{e.aboutModalOpen=!e.aboutModalOpen},resetInterface:()=>Me,nodeHovered:(e,t)=>{e.hoveredNodeId=t.payload,e.lastInteraction=Date.now()},nodeUnhovered:e=>{e.hoveredNodeId=null},nodeSelected:(e,t)=>{e.selectedNodeId!==t.payload&&(e.selectedNodeId=t.payload,e.viewMode="reading",e.lastInteraction=Date.now())},returnToConstellation:e=>{e.viewMode="constellation"}}}),{setViewMode:Tn,toggleMiniConstellation:En,toggleMetaInterface:Mn,toggleStrangeAttractors:An,setConstellationZoom:Pn,setConstellationRotation:kn,setTextSize:Rn,toggleHighContrast:xn,setAnimations:$n,setTransitionSpeed:Nn,toggleHelpModal:On,toggleAboutModal:qn,resetInterface:zn,nodeHovered:In,nodeUnhovered:jn,nodeSelected:Dn,returnToConstellation:Fn}=Ve.actions,Hn=e=>e.interface.viewMode,Vn=e=>e.interface.hoveredNodeId,Wn=e=>e.interface.selectedNodeId,Bn=Ve.reducer;export{re as A,Fn as B,Wn as a,In as b,Dn as c,Tn as d,gn as e,bn as f,fn as g,_n as h,yn as i,ln as j,un as k,on as l,Bn as m,jn as n,Sn as o,mn as p,rn as q,cn as r,Vn as s,Ee as t,an as u,sn as v,Hn as w,ne as x,pn as y,hn as z};
//# sourceMappingURL=constellation-9EXX-9rV.js.map
