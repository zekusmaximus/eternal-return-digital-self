const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ConstellationView-CEQ12AU_.js","assets/three-vendor-CMUj8LmA.js","assets/react-vendor-CLXXY-Bz.js","assets/constellation-9EXX-9rV.js","assets/ConstellationView-oNlteI-u.css","assets/NodeView-DAT5rllo.js","assets/narramorph-DAUxO-pP.js","assets/narramorph-DivzNTyX.css","assets/node-view-BVBDDUA3.js","assets/node-view-_8ZIE8wg.css","assets/NodeView-BByraZ2W.css","assets/Onboarding-CeOdP8-D.js","assets/onboarding-BZ32dd4_.js","assets/onboarding-DUJh0eI2.css"])))=>i.map(i=>d[i]);
var O=Object.defineProperty;var j=(o,e,t)=>e in o?O(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var u=(o,e,t)=>j(o,typeof e!="symbol"?e+"":e,t);import{j as l,_ as T}from"./three-vendor-CMUj8LmA.js";import{b as f,g as N,p as k,d as z,l as U,F as q,R as H,P as B,m as F,n as K,o as J,q as X,c as Y}from"./react-vendor-CLXXY-Bz.js";import{l as Q,m as Z,o as ee,p as te,q as ne,w as oe,x as re}from"./constellation-9EXX-9rV.js";const g=class g{constructor(){u(this,"contexts",new Map);u(this,"activeContextId",null);u(this,"contextCounter",0);u(this,"contextLossEvents",0);u(this,"maxAllowedContexts",2);u(this,"diagnosticsEnabled",!0);u(this,"memoryCheckInterval",null);this.startMemoryMonitoring(),console.log("[WebGLContextManager] Initialized")}static getInstance(){return g.instance||(g.instance=new g),g.instance}registerContext(e,t,n=1,i=()=>{},a=()=>{}){const r=`webgl-context-${++this.contextCounter}-${t}-${Date.now()}`;console.log(`[WebGLContextManager] Registering new ${t} WebGL context: ${r}`),this.contexts.set(r,{id:r,type:t,gl:e,active:!0,createdAt:Date.now(),priority:n,suspend:i,resume:a,memoryUsage:{geometries:0,textures:0}}),this.enforceContextLimits(),this.updateContextMemoryUsage(r);const s=e.domElement;return s.addEventListener("webglcontextlost",c=>{this.handleContextLoss(r,c)}),s.addEventListener("webglcontextrestored",()=>{this.handleContextRestoration(r)}),r}disposeContext(e){const t=this.contexts.get(e);if(!t)return console.warn(`[WebGLContextManager] Attempted to dispose unknown context: ${e}`),!1;console.log(`[WebGLContextManager] Disposing ${t.type} WebGL context: ${e}`);try{return t.gl.dispose(),this.contexts.delete(e),this.activeContextId===e&&(this.activeContextId=null),this.enforceContextLimits(),!0}catch(n){return console.error(`[WebGLContextManager] Error disposing context ${e}:`,n),!1}}suspendContext(e){const t=this.contexts.get(e);if(!t)return!1;if(t.active){console.log(`[WebGLContextManager] Suspending ${t.type} WebGL context: ${e}`),t.active=!1,t.suspend(),t.gl.setPixelRatio(.5),t.gl.setSize(1,1,!1);try{const n=t.gl.getContext();n&&"UNPACK_COLORSPACE_CONVERSION_WEBGL"in n&&n.hint(n.GENERATE_MIPMAP_HINT,n.FASTEST)}catch{}return!0}return!1}resumeContext(e){const t=this.contexts.get(e);return t?t.active?!1:(console.log(`[WebGLContextManager] Resuming ${t.type} WebGL context: ${e}`),t.active=!0,t.resume(),this.activeContextId=e,this.enforceContextLimits(),!0):!1}isContextTypeActive(e){for(const[,t]of this.contexts.entries())if(t.type===e&&t.active)return!0;return!1}handleContextLoss(e,t){const n=this.contexts.get(e);n&&(this.contextLossEvents++,console.error(`[WebGLContextManager] WebGL context loss detected for ${n.type} context: ${e}`),console.error(`[WebGLContextManager] Total context loss events: ${this.contextLossEvents}`),t.preventDefault(),n.active=!1,this.emergencyResourceRecovery(),window.dispatchEvent(new CustomEvent("webgl-context-loss",{detail:{contextId:e,type:n.type}})))}handleContextRestoration(e){const t=this.contexts.get(e);t&&(console.log(`[WebGLContextManager] WebGL context restored for ${t.type} context: ${e}`),t.active=!0,window.dispatchEvent(new CustomEvent("webgl-context-restored",{detail:{contextId:e,type:t.type}})))}enforceContextLimits(){const e=Array.from(this.contexts.values()).filter(t=>t.active).sort((t,n)=>n.priority-t.priority);if(e.length>this.maxAllowedContexts){console.log(`[WebGLContextManager] Too many active contexts (${e.length}/${this.maxAllowedContexts}), suspending lower priority contexts`);for(let t=this.maxAllowedContexts;t<e.length;t++)this.suspendContext(e[t].id)}}emergencyResourceRecovery(){if(console.log("[WebGLContextManager] Performing emergency resource recovery"),window.gc)try{window.gc()}catch{}const e=Array.from(this.contexts.values()).sort((t,n)=>n.priority-t.priority);if(e.length>0)for(let t=1;t<e.length;t++)this.suspendContext(e[t].id)}startMemoryMonitoring(){this.memoryCheckInterval&&clearInterval(this.memoryCheckInterval),this.memoryCheckInterval=setInterval(()=>{if(!this.diagnosticsEnabled)return;for(const[t]of this.contexts.entries())this.updateContextMemoryUsage(t);const e={geometries:0,textures:0,contexts:this.contexts.size,active:Array.from(this.contexts.values()).filter(t=>t.active).length};for(const t of this.contexts.values())t.memoryUsage&&(e.geometries+=t.memoryUsage.geometries,e.textures+=t.memoryUsage.textures);e.contexts>0&&console.log("[WebGLContextManager] Memory usage:",e)},1e4)}updateContextMemoryUsage(e){const t=this.contexts.get(e);if(t)try{const n=t.gl;n&&n.info&&(t.memoryUsage={geometries:n.info.memory.geometries,textures:n.info.memory.textures})}catch{}}getActiveContext(){const e=Array.from(this.contexts.values()).filter(t=>t.active).sort((t,n)=>n.priority-t.priority);return e.length>0?e[0]:null}disposeAllContexts(){console.log(`[WebGLContextManager] Disposing all WebGL contexts (${this.contexts.size})`);for(const[e,t]of this.contexts.entries())try{t.gl.dispose()}catch(n){console.error(`[WebGLContextManager] Error disposing context ${e}:`,n)}this.contexts.clear(),this.activeContextId=null,this.memoryCheckInterval&&(clearInterval(this.memoryCheckInterval),this.memoryCheckInterval=null)}getRendererFromRef(e){return e.current}checkWebGLSupport(){var t;const e={webgl:!1,webgl2:!1,extensions:[],maxTextures:0,vendor:void 0,renderer:void 0,isLowEndDevice:!1};try{const n=document.createElement("canvas"),i=n.getContext("webgl");if(e.webgl=!!i,i){const r=i.getSupportedExtensions();e.extensions=r||[],e.maxTextures=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);const s=i.getExtension("WEBGL_debug_renderer_info");if(s){e.vendor=i.getParameter(s.UNMASKED_VENDOR_WEBGL),e.renderer=i.getParameter(s.UNMASKED_RENDERER_WEBGL);const c=((t=e.renderer)==null?void 0:t.toLowerCase())||"";e.isLowEndDevice=c.includes("intel")||c.includes("hd graphics")||c.includes("mobile")||!e.extensions.includes("OES_texture_float")}}const a=n.getContext("webgl2");e.webgl2=!!a,n.remove()}catch(n){console.error("[WebGLContextManager] Error checking WebGL support:",n)}return e}};u(g,"instance");let L=g;const M=L.getInstance(),h=class h{constructor(){u(this,"state",{activeView:"loading",previousView:null,isTransitioning:!1,transitionStartTime:0,uniqueViewKey:"view-0",transitionCount:0});u(this,"transitionCallbacks",{});u(this,"transitionTimeout",null);u(this,"viewComponents",new Map);u(this,"transitionDuration",300);console.log("[ViewManager] Initialized"),this.viewComponents.set("constellation",!1),this.viewComponents.set("reading",!1),this.viewComponents.set("loading",!1)}static getInstance(){return h.instance||(h.instance=new h),h.instance}getViewState(){return{...this.state}}setActiveView(e){if(e===this.state.activeView&&!this.state.isTransitioning){console.log(`[ViewManager] View ${e} is already active, ignoring`);return}console.log(`[ViewManager] Transitioning from ${this.state.activeView} to ${e}`),this.transitionTimeout&&(clearTimeout(this.transitionTimeout),this.transitionTimeout=null);const t=this.state.activeView;this.state={...this.state,previousView:t,activeView:e,isTransitioning:!0,transitionStartTime:Date.now(),transitionCount:this.state.transitionCount+1,uniqueViewKey:`view-${Date.now()}-${Math.random().toString(36).substr(2,5)}`},this.transitionCallbacks.onBeforeTransition&&this.transitionCallbacks.onBeforeTransition(t,e),this.manageWebGLContexts(t,e),this.transitionTimeout=setTimeout(()=>{this.state={...this.state,isTransitioning:!1},this.transitionCallbacks.onAfterTransition&&this.transitionCallbacks.onAfterTransition(t,e),console.log(`[ViewManager] Transition to ${e} complete (${Date.now()-this.state.transitionStartTime}ms)`),this.transitionTimeout=null},this.transitionDuration)}registerTransitionCallbacks(e){this.transitionCallbacks={...e}}registerViewMount(e,t){this.viewComponents.set(e,t),console.log(`[ViewManager] View ${e} ${t?"mounted":"unmounted"}`);let n=0;const i=[];this.viewComponents.forEach((a,r)=>{a&&(n++,i.push(r))}),n>1&&i.includes("constellation")&&i.includes("reading")&&console.warn("[ViewManager] Multiple main views mounted simultaneously:",i.join(", "))}isViewActive(e){return this.state.activeView===e}getUniqueViewKey(){return this.state.uniqueViewKey}manageWebGLContexts(e,t){e==="constellation"&&t==="reading"&&M.isContextTypeActive("constellation")&&console.log("[ViewManager] Suspending constellation WebGL context during transition to reading view"),e==="reading"&&t==="constellation"&&console.log("[ViewManager] Will resume constellation WebGL context")}getViewTransitionMetrics(){return{transitionCount:this.state.transitionCount,averageTransitionTime:0,problematicTransitions:0}}};u(h,"instance");let R=h;const w=R.getInstance();function C(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?C=function(t){return typeof t}:C=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(o)}function se(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function ie(o,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}function ae(o,e,t){return e&&ie(o.prototype,e),o}function ce(o,e){return e&&(C(e)==="object"||typeof e=="function")?e:S(o)}function A(o){return A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},A(o)}function S(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function le(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),e&&G(o,e)}function G(o,e){return G=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},G(o,e)}function E(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var I=function(o){le(e,o);function e(){var t,n;se(this,e);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return n=ce(this,(t=A(e)).call.apply(t,[this].concat(a))),E(S(n),"state",{bootstrapped:!1}),E(S(n),"_unsubscribe",void 0),E(S(n),"handlePersistorState",function(){var s=n.props.persistor,c=s.getState(),d=c.bootstrapped;d&&(n.props.onBeforeLift?Promise.resolve(n.props.onBeforeLift()).finally(function(){return n.setState({bootstrapped:!0})}):n.setState({bootstrapped:!0}),n._unsubscribe&&n._unsubscribe())}),n}return ae(e,[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return typeof this.props.children=="function"?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}]),e}(f.PureComponent);E(I,"defaultProps",{children:null,loading:null});var x={},y={},b={},P;function ue(){if(P)return b;P=1,b.__esModule=!0,b.default=i;function o(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(s){return typeof s}:o=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},o(a)}function e(){}var t={getItem:e,setItem:e,removeItem:e};function n(a){if((typeof self>"u"?"undefined":o(self))!=="object"||!(a in self))return!1;try{var r=self[a],s="redux-persist ".concat(a," test");r.setItem(s,"test"),r.getItem(s),r.removeItem(s)}catch{return!1}return!0}function i(a){var r="".concat(a,"Storage");return n(r)?self[r]:t}return b}var V;function fe(){if(V)return y;V=1,y.__esModule=!0,y.default=t;var o=e(ue());function e(n){return n&&n.__esModule?n:{default:n}}function t(n){var i=(0,o.default)(n);return{getItem:function(r){return new Promise(function(s,c){s(i.getItem(r))})},setItem:function(r,s){return new Promise(function(c,d){c(i.setItem(r,s))})},removeItem:function(r){return new Promise(function(s,c){s(i.removeItem(r))})}}}return y}var $;function me(){if($)return x;$=1,x.__esModule=!0,x.default=void 0;var o=e(fe());function e(n){return n&&n.__esModule?n:{default:n}}var t=(0,o.default)("local");return x.default=t,x}var de=me();const pe=N(de),ge={key:"eternal-return",version:1,storage:pe,blacklist:["interface"]},he=z({nodes:te,reader:ee,interface:Z}),xe=U(ge,he),D=Q({reducer:xe,middleware:o=>o({serializableCheck:{ignoredActions:[q,H,B,F,K,J]}}),devTools:typeof window<"u"&&"process"in window&&typeof window.process.env.NODE_ENV<"u"&&window.process.env.NODE_ENV!=="production"}),ve=k(D);function we(o){return"memory"in o}const ye=f.lazy(()=>T(()=>import("./ConstellationView-CEQ12AU_.js"),__vite__mapDeps([0,1,2,3,4]))),be=f.lazy(()=>T(()=>import("./NodeView-DAT5rllo.js"),__vite__mapDeps([5,1,2,6,3,7,8,9,10]))),Ce=f.lazy(()=>T(()=>import("./Onboarding-CeOdP8-D.js"),__vite__mapDeps([11,1,2,12,13]))),Se=()=>l.jsxs("div",{className:"loading-container",children:[l.jsx("div",{className:"loading-spinner"}),l.jsx("p",{children:"Loading view..."})]});function Ee(){const o=ne(),e=Y(oe),[t,n]=f.useState([]),i=f.useRef(e),[a,r]=f.useState([]),s=f.useRef(null);return f.useEffect(()=>{if(!s.current){console.log("[App] Starting performance monitoring");const c=()=>{var v;const d=performance.now(),m=1e3/(d-(((v=a[a.length-1])==null?void 0:v.timestamp)||d-1e3));let p;we(performance)&&performance.memory&&(p={jsHeapSizeLimit:performance.memory.jsHeapSizeLimit,totalJSHeapSize:performance.memory.totalJSHeapSize,usedJSHeapSize:performance.memory.usedJSHeapSize}),r(W=>{const _=[...W,{timestamp:d,fps:Math.min(60,m),memory:p}];return _.length>100?_.slice(-100):_}),s.current=requestAnimationFrame(c)};s.current=requestAnimationFrame(c)}return()=>{s.current&&(cancelAnimationFrame(s.current),s.current=null)}},[a]),f.useEffect(()=>{if(i.current!==e){if(w.setActiveView(e),console.log(`[App] View transition: ${i.current} -> ${e}`),n(c=>[...c,{from:i.current,to:e,timestamp:Date.now()}]),a.length>0){const c=a[a.length-1];console.log("[App] Performance at transition:",{fps:c.fps.toFixed(1),memory:c.memory?{used:(c.memory.usedJSHeapSize/(1024*1024)).toFixed(1)+"MB",total:(c.memory.totalJSHeapSize/(1024*1024)).toFixed(1)+"MB"}:"unavailable",transitions:t.length+1})}i.current=e}},[e,t,a]),f.useEffect(()=>{console.log("[App] Initializing application"),o(re())},[o]),f.useEffect(()=>{const c=m=>{m.message&&(m.message.includes("WebGL context lost")||m.message.includes("THREE.WebGLRenderer"))&&console.error("[App] WebGL context loss detected at app level!",{message:m.message,viewMode:e,transitions:t.length,timestamp:Date.now()})},d=m=>{const{contextId:p,type:v}=m.detail;console.error("[App] WebGL context loss event received from WebGLContextManager",{contextId:p,type:v,viewMode:e,timestamp:Date.now()}),M.checkWebGLSupport().isLowEndDevice&&console.warn("[App] Device seems to be low-end, may need to disable visual effects")};return window.addEventListener("error",c),window.addEventListener("webgl-context-loss",d),w.registerTransitionCallbacks({onBeforeTransition:(m,p)=>{console.log(`[App] ViewManager transition started: ${m} → ${p}`)},onAfterTransition:(m,p)=>{console.log(`[App] ViewManager transition completed: ${m} → ${p}`)}}),()=>{window.removeEventListener("error",c),window.removeEventListener("webgl-context-loss",d),M.disposeAllContexts(),console.log("[App] Disposed all WebGL contexts on unmount")}},[e,t]),l.jsxs("div",{className:"app-container",children:[l.jsx("header",{className:"app-header",children:l.jsx("h1",{className:"app-title",children:"The Eternal Return of the Digital Self"})}),l.jsxs("div",{className:"stars-container",children:[l.jsx("div",{className:"stars"}),l.jsx("div",{className:"stars2"}),l.jsx("div",{className:"stars3"})]}),l.jsx(f.Suspense,{fallback:l.jsx(Se,{}),children:e==="constellation"?l.jsx(ye,{},`constellation-${w.getUniqueViewKey()}`):l.jsx(be,{},`node-${w.getUniqueViewKey()}`)}),l.jsx(f.Suspense,{fallback:l.jsx("div",{}),children:l.jsx(Ce,{})}),!1]})}function _e(){return l.jsx(X,{store:D,children:l.jsx(I,{loading:l.jsx("div",{children:"Loading..."}),persistor:ve,children:l.jsx(Ee,{})})})}const Ge=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{Ge as a,w as v,M as w};
//# sourceMappingURL=app-wopjO8iA.js.map
